{
 "creation": "2025-12-01 12:26:53.163327",
 "docstatus": 0,
 "doctype": "Page",
 "idx": 0,
 "modified": "2025-12-01 12:26:53.163327",
 "modified_by": "Administrator",
 "module": "Formation Management",
 "name": "formation-overview",
 "owner": "Administrator",
 "page_name": "formation-overview",
 "roles": [],
 "standard": "Yes",
 "style": null,
 "system_page": 0,
 "title": "Vue d'ensemble des formations",
 "content" : [
  {
   "content": "<div class=\"page-head\">\n    <h1>Vue d'ensemble des formations</h1>\n    <p class=\"text-muted\">Gestion complète des sessions de formation à venir</p>\n</div>",
   "col": 12,
   "section": "header"
  },
  {
   "content": "<div class=\"row\">\n    <div class=\"col-md-3\">\n        <div class=\"widget widget-counter bg-blue\">\n            <div class=\"widget-content\">\n                <span class=\"widget-label\">Sessions Planifiées</span>\n                <span class=\"widget-value\" data-doctype=\"Session de Formation\" data-field=\"total_sessions\">0</span>\n            </div>\n        </div>\n    </div>\n    <div class=\"col-md-3\">\n        <div class=\"widget widget-counter bg-green\">\n            <div class=\"widget-content\">\n                <span class=\"widget-label\">Cours Différents</span>\n                <span class=\"widget-value\" data-doctype=\"Cours\" data-field=\"total_cours\">0</span>\n            </div>\n        </div>\n    </div>\n    <div class=\"col-md-3\">\n        <div class=\"widget widget-counter bg-orange\">\n            <div class=\"widget-content\">\n                <span class=\"widget-label\">Formateurs Actifs</span>\n                <span class=\"widget-value\" data-doctype=\"Formateur\" data-field=\"total_formateurs\">0</span>\n            </div>\n        </div>\n    </div>\n    <div class=\"col-md-3\">\n        <div class=\"widget widget-counter bg-red\">\n            <div class=\"widget-content\">\n                <span class=\"widget-label\">Participants Totaux</span>\n                <span class=\"widget-value\" data-doctype=\"Participant\" data-field=\"total_participants\">0</span>\n            </div>\n        </div>\n    </div>\n</div>",
   "col": 12,
   "section": "stats"
  },
  {
   "content": "<div class=\"row\">\n    <div class=\"col-12\">\n        <div class=\"card\">\n            <div class=\"card-header\">\n                <h5 class=\"card-title\">Sessions à Venir</h5>\n                <button class=\"btn btn-primary btn-sm\" onclick=\"refreshSessions()\">Actualiser</button>\n            </div>\n            <div class=\"card-body\">\n                <div id=\"sessions-table\">\n                    <!-- Le tableau sera chargé ici par JavaScript -->\n                </div>\n            </div>\n        </div>\n    </div>\n</div>",
   "col": 12,
   "section": "sessions"
  }
 ],
 "css": ".page-head { margin-bottom: 30px; }\n.widget-counter { border-radius: 8px; padding: 20px; color: white; text-align: center; }\n.widget-counter .widget-label { font-size: 14px; display: block; }\n.widget-counter .widget-value { font-size: 32px; font-weight: bold; display: block; }\n.bg-blue { background-color: #2e86ab; }\n.bg-green { background-color: #28a745; }\n.bg-orange { background-color: #fd7e14; }\n.bg-red { background-color: #dc3545; }\n.card { margin-top: 20px; }",
 "script": "frappe.ready(function() {\n    loadStats();\n    loadSessions();\n    \n    // Message d'introduction\n    frappe.set_intro(`\n        <h4>Bienvenue dans la vue d'ensemble des formations</h4>\n        <p>Cette page vous permet de :</p>\n        <ul>\n            <li>Voir les sessions à venir</li>\n            <li>Consulter les statistiques globales</li>\n            <li>Accéder rapidement aux détails des sessions</li>\n        </ul>\n    `);\n});\n\nfunction loadStats() {\n    // Charger les statistiques via un appel API\n    frappe.call({\n        method: 'gestion_formation.pages.formation_overview.get_statistiques_globales',\n        callback: function(r) {\n            if (r.message) {\n                const stats = r.message;\n                $('[data-field=\"total_sessions\"]').text(stats.total_sessions || 0);\n                $('[data-field=\"total_cours\"]').text(stats.total_cours || 0);\n                $('[data-field=\"total_formateurs\"]').text(stats.total_formateurs || 0);\n                $('[data-field=\"total_participants\"]').text(stats.total_participants || 0);\n            }\n        }\n    });\n}\n\nfunction loadSessions() {\n    frappe.call({\n        method: 'gestion_formation.pages.formation_overview.get_sessions_a_venir',\n        callback: function(r) {\n            if (r.message) {\n                renderSessionsTable(r.message);\n            }\n        }\n    });\n}\n\nfunction renderSessionsTable(sessions) {\n    let html = `\n        <table class=\"table table-striped\">\n            <thead>\n                <tr>\n                    <th>Session</th>\n                    <th>Cours</th>\n                    <th>Formateur</th>\n                    <th>Date Début</th>\n                    <th>Date Fin</th>\n                    <th>Participants</th>\n                    <th>Actions</th>\n                </tr>\n            </thead>\n            <tbody>\n    `;\n    \n    if (sessions && sessions.length > 0) {\n        sessions.forEach(session => {\n            html += `\n                <tr>\n                    <td>\n                        <strong>${session.name}</strong>\n                        ${session.lieu ? `<br><small class=\"text-muted\">${session.lieu}</small>` : ''}\n                    </td>\n                    <td>${session.cours}</td>\n                    <td>${session.formateur}</td>\n                    <td>${frappe.datetime.str_to_user(session.date_debut)}</td>\n                    <td>${frappe.datetime.str_to_user(session.date_fin)}</td>\n                    <td>\n                        <span class=\"badge ${session.nombre_participants > 0 ? 'badge-success' : 'badge-secondary'}\">\n                            ${session.nombre_participants || 0}\n                        </span>\n                    </td>\n                    <td>\n                        <button class=\"btn btn-sm btn-outline-primary\" onclick=\"showSessionDetails('${session.name}')\">\n                            <i class=\"fa fa-eye\"></i> Détails\n                        </button>\n                    </td>\n                </tr>\n            `;\n        });\n    } else {\n        html += `\n            <tr>\n                <td colspan=\"7\" class=\"text-center text-muted\">\n                    <i class=\"fa fa-calendar-times-o fa-2x mb-2\"></i><br>\n                    Aucune session à venir\n                </td>\n            </tr>\n        `;\n    }\n    \n    html += `\n            </tbody>\n        </table>\n    `;\n    \n    $('#sessions-table').html(html);\n}\n\nfunction showSessionDetails(sessionName) {\n    frappe.call({\n        method: 'gestion_formation.pages.formation_overview.get_session_details',\n        args: { session_name: sessionName },\n        callback: function(r) {\n            if (r.message) {\n                const session = r.message;\n                const content = `\n                    <div>\n                        <h5>Détails de la Session</h5>\n                        <p><strong>Cours:</strong> ${session.cours}</p>\n                        <p><strong>Formateur:</strong> ${session.formateur}</p>\n                        <p><strong>Dates:</strong> Du ${frappe.datetime.str_to_user(session.date_debut)} au ${frappe.datetime.str_to_user(session.date_fin)}</p>\n                        <p><strong>Lieu:</strong> ${session.lieu || 'Non spécifié'}</p>\n                        <p><strong>Nombre de participants:</strong> ${session.participants_count}</p>\n                    </div>\n                `;\n                \n                frappe.msgprint({\n                    title: `Session: ${session.name}`,\n                    message: content,\n                    indicator: 'blue'\n                });\n            }\n        }\n    });\n}\n\nfunction refreshSessions() {\n    loadSessions();\n    frappe.show_alert({\n        message: 'Liste des sessions actualisée',\n        indicator: 'green'\n    });\n}"
}